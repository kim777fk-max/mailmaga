<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ¡ãƒ«ãƒã‚¬åŸç¨¿ãƒ•ã‚©ãƒ¼ãƒ </title>
  <style>
    :root {
      --purple:       #673ab7;
      --purple-dark:  #512da8;
      --purple-light: #ede7f6;
      --red:    #d32f2f;
      --orange: #e65100;
      --green:  #2e7d32;
      --bg:     #f0ebf8;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', 'Yu Gothic', sans-serif;
      background: var(--bg);
      padding: 20px 16px 60px;
      font-size: 14px;
      color: #333;
      line-height: 1.6;
    }
    .wrap { max-width: 680px; margin: 0 auto; }

    .card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,.12);
      padding: 24px;
      margin-bottom: 12px;
    }
    .card.top-border { border-top: 8px solid var(--purple); }
    .card h1 { font-size: 22px; color: #222; margin-bottom: 6px; }
    .sub-desc { color: #777; font-size: 13px; }

    .field { margin-bottom: 22px; }
    .field:last-child { margin-bottom: 0; }
    .field > label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
    }
    .field > label .req  { color: var(--red); margin-left: 3px; }
    .field > label .hint {
      font-weight: 400;
      color: #aaa;
      font-size: 12px;
      margin-left: 6px;
    }

    input[type=text], input[type=date], select {
      width: 100%;
      border: none;
      border-bottom: 1px solid #ccc;
      padding: 8px 2px;
      font-size: 15px;
      font-family: inherit;
      outline: none;
      background: transparent;
      transition: border-color .2s;
    }
    input[type=text]:focus, input[type=date]:focus, select:focus {
      border-bottom: 2px solid var(--purple);
    }
    select { cursor: pointer; }

    .ta-box {
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
      transition: border-color .2s;
    }
    .ta-box:focus-within { border: 2px solid var(--purple); }
    textarea {
      display: block;
      width: 100%;
      padding: 12px;
      font-size: 14px;
      font-family: 'Courier New', 'Osaka-Mono', monospace;
      line-height: 1.8;
      border: none;
      outline: none;
      resize: vertical;
      background: #fafafa;
    }
    #content   { min-height: 280px; }
    #contact   { min-height: 60px; }

    .ta-footer {
      background: #f0f0f0;
      border-top: 1px solid #e0e0e0;
      padding: 6px 12px;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      font-size: 12px;
      color: #777;
    }
    #stat-over { color: var(--orange); font-weight: 600; }

    .line-detail {
      margin-top: 6px;
      max-height: 130px;
      overflow-y: auto;
      background: #fafafa;
      border: 1px solid #eee;
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 12px;
      line-height: 2;
      display: none;
    }
    .line-ok   { color: #bbb; }
    .line-warn { color: var(--orange); font-weight: 600; }

    .check-panel {
      margin-top: 10px;
      padding: 10px 14px;
      border-radius: 6px;
      font-size: 13px;
    }
    .check-panel.clean  { background: #e8f5e9; color: var(--green); }
    .check-panel.issues { background: #fff8e1; color: #5d4037; }
    .check-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 4px 0;
    }
    .check-ico { flex-shrink: 0; font-size: 15px; }
    .fix-btn {
      display: inline-block;
      padding: 2px 10px;
      background: var(--purple);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 12px;
      cursor: pointer;
      margin-left: 8px;
      white-space: nowrap;
    }
    .fix-btn:hover { background: var(--purple-dark); }

    .preview-toggle {
      background: none;
      border: none;
      color: var(--purple);
      cursor: pointer;
      font-size: 13px;
      text-decoration: underline;
      padding: 0;
      margin-top: 12px;
      display: none;
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
    .preview-box {
      margin-top: 8px;
      background: #fff;
      border: 2px solid var(--purple-light);
      border-radius: 4px;
      padding: 16px 18px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.9;
      white-space: pre;
      max-height: 420px;
      overflow-y: auto;
      overflow-x: hidden;
      color: #333;
      display: none;
    }

    .sec-title {
      font-size: 12px;
      font-weight: 700;
      color: var(--purple);
      text-transform: uppercase;
      letter-spacing: .5px;
      border-bottom: 1px solid var(--purple-light);
      padding-bottom: 6px;
      margin-bottom: 18px;
    }

    .btn-row { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn {
      padding: 11px 24px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-family: inherit;
      font-weight: 500;
      transition: background .2s, opacity .2s;
    }
    .btn-primary { background: var(--purple); color: #fff; }
    .btn-primary:hover { background: var(--purple-dark); }
    .btn-outline { background: #fff; border: 1px solid var(--purple); color: var(--purple); }
    .btn-outline:hover { background: var(--purple-light); }
    .btn:disabled { opacity: .5; cursor: not-allowed; }

    .alert {
      margin-top: 12px;
      padding: 12px 16px;
      border-radius: 4px;
      font-size: 13px;
      line-height: 1.8;
    }
    .alert-success { background: #e8f5e9; color: #1b5e20; border-left: 4px solid #4caf50; }
    .alert-error   { background: #ffebee; color: #b71c1c; border-left: 4px solid #f44336; font-weight: 500; }

    .info-box {
      margin-top: 14px;
      background: #e8eaf6;
      border: 1px solid #c5cae9;
      border-radius: 6px;
      padding: 12px 14px;
      font-size: 12px;
      color: #283593;
      line-height: 1.8;
    }
    .info-box code {
      background: #c5cae9;
      padding: 1px 5px;
      border-radius: 3px;
      font-size: 11px;
    }
    .ai-note {
      margin-top: 10px;
      background: #e3f2fd;
      border: 1px solid #90caf9;
      border-radius: 6px;
      padding: 10px 14px;
      font-size: 12px;
      color: #1565c0;
      line-height: 1.7;
    }
    .spec-note {
      background: #fffde7;
      border-left: 4px solid #f9a825;
    }
    .spec-title {
      font-size: 13px;
      font-weight: 700;
      color: #5d4037;
      margin-bottom: 10px;
    }
    .spec-list {
      margin: 0;
      padding-left: 1.4em;
      font-size: 13px;
      color: #4e342e;
      line-height: 2;
    }
    .spec-list li strong { color: #b71c1c; }
    .contact-check-label {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-top: 14px;
      padding: 12px 14px;
      background: #fff3e0;
      border: 1px solid #ffb74d;
      border-radius: 6px;
      font-size: 13px;
      color: #e65100;
      font-weight: 600;
      cursor: pointer;
      line-height: 1.5;
    }
    .contact-check-label input[type=checkbox] {
      margin-top: 2px;
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      accent-color: var(--purple);
      cursor: pointer;
    }
    .contact-check-label.checked {
      background: #e8f5e9;
      border-color: #81c784;
      color: var(--green);
    }
    .spec-list code {
      background: #ffe082;
      padding: 1px 5px;
      border-radius: 3px;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      color: #4e342e;
    }
  </style>
</head>
<body>
<div class="wrap">

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="card top-border">
    <h1>ãƒ¡ãƒ«ãƒã‚¬åŸç¨¿ãƒ•ã‚©ãƒ¼ãƒ </h1>
    <p class="sub-desc">åŸç¨¿ã‚’å…¥åŠ›ã—ã¦ã€Œãƒã‚§ãƒƒã‚¯å®Ÿè¡Œã€â†’ã€Œãƒ†ã‚­ã‚¹ãƒˆä¿å­˜ã€ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ãƒ•ã‚©ãƒ«ãƒ€ã¸ï¼ˆãƒ¡ãƒ¼ãƒ«ã§ã”æ¡ˆå†…ã—ãŸå ´æ‰€ã«ï¼‰ç§»å‹•ã—ã¦ãã ã•ã„ã€‚</p>
  </div>

  <!-- å…¥åŠ›ä»•æ§˜ã®æ³¨æ„æ›¸ã -->
  <div class="card spec-note">
    <div class="spec-title">ğŸ“‹ å…¥åŠ›ä»•æ§˜ã«ã¤ã„ã¦</div>
    <ul class="spec-list">
      <li>æ–‡é ­ï¼ˆ1è¡Œç›®ï¼‰ã¯æ®µè½ã®å§‹ã¾ã‚Šã¨ã¿ãªã—ã€å…ˆé ­ã«<strong>å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ãŒè‡ªå‹•ã§å…¥ã‚Šã¾ã™</strong>ã€‚</li>
      <li><strong>Enterã‚­ãƒ¼ã§æ”¹è¡Œ</strong>ã™ã‚‹ã¨ã€æ®µè½ãŒå¤‰ã‚ã£ãŸã¨ã¿ãªã—ã¦æ¬¡ã®è¡Œã®å…ˆé ­ã«å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ãŒè‡ªå‹•ã§å…¥ã‚Šã¾ã™ã€‚</li>
      <li>å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ãŒä¸è¦ãªå ´åˆï¼ˆç®‡æ¡æ›¸ãã‚„è¦‹å‡ºã—ãªã©ï¼‰ã¯ã€Backspaceã§å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚å‰Šé™¤ã—ã¦ã‚‚<strong>æ”¹è¡Œä½ç½®ã¯ä¿æŒã•ã‚Œã¾ã™</strong>ã€‚</li>
      <li>ä¿æŒã•ã‚ŒãŸæ”¹è¡Œã‚’ã•ã‚‰ã«Backspaceã™ã‚‹ã¨ã€å‰ã®è¡Œã«æˆ»ã‚Šã¾ã™ï¼ˆæ”¹è¡Œã‚’å®Œå…¨ã«å–ã‚Šæ¶ˆã™ï¼‰ã€‚</li>
      <li>æœ¬æ–‡ã¯å…¨ä½“çš„ã«<strong>20æ–‡å­—ã§è‡ªå‹•æ”¹è¡Œ</strong>ã•ã‚Œã¾ã™ã€‚å‰ã®è¡ŒãŒ20æ–‡å­—æœªæº€ã«ãªã‚‹ã¨ã€æ¬¡ã®è¡Œã‹ã‚‰æ–‡å­—ãŒè‡ªå‹•ã§å¼•ãæˆ»ã•ã‚Œã¾ã™ã€‚</li>
      <li>URLãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å«ã‚€è¡Œã¯<strong>è‡ªå‹•æ”¹è¡Œã®å¯¾è±¡å¤–</strong>ã§ã™ï¼ˆãƒªãƒ³ã‚¯ãŒåˆ‡ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ï¼‰ã€‚</li>
      <li><strong>å–ã‚Šæ¶ˆã—ï¼ˆUndoï¼‰</strong>ï¼šMac ã¯ <code>Cmd+Z</code>ã€Windows ã¯ <code>Ctrl+Z</code></li>
      <li><strong>ã‚„ã‚Šç›´ã—ï¼ˆRedoï¼‰</strong>ï¼šMac ã¯ <code>Cmd+Shift+Z</code>ã€Windows ã¯ <code>Ctrl+Y</code></li>
    </ul>
  </div>

  <form id="mainForm" novalidate>

    <!-- éƒ¨ç½²å -->
    <div class="card">
      <div class="field">
        <label>éƒ¨ç½²å<span class="req">*</span></label>
        <select id="department">
          <option value="">â€” é¸æŠã—ã¦ãã ã•ã„ â€”</option>
          <option>ã¯ã˜ã‚ã«</option>
          <option>ä¼šé•·æŒ¨æ‹¶</option>
          <option>æ¿è¨ºå¡¾</option>
          <option>ç ”ä¿®éƒ¨</option>
          <option>ç·å‹™éƒ¨</option>
          <option>åœ°åŸŸæ”¯æ´éƒ¨</option>
          <option>äº‹æ¥­æ”¯æ´éƒ¨</option>
          <option>å›½éš›éƒ¨</option>
          <option>ä¼šå“¡éƒ¨</option>
          <option>æ¸‰å¤–éƒ¨</option>
          <option>ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å®¤</option>
          <option>åºƒå ±éƒ¨</option>
          <option>æ¿æ©‹åŒºç°¡æ˜“å‹BCPç­–å®šæ”¯æ´äº‹æ¥­</option>
          <option>ãã®ä»–ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</option>
        </select>
        <input type="text" id="department_custom" placeholder="éƒ¨ç½²åã‚’å…¥åŠ›"
               style="display:none; margin-top:8px;">
      </div>
    </div>

    <!-- æœ¬æ–‡ -->
    <div class="card">
      <div class="sec-title">æœ¬æ–‡</div>
      <div class="field">
        <label>
          æœ¬æ–‡<span class="req">*</span>
          <span class="hint">20æ–‡å­—ã§è‡ªå‹•æ”¹è¡Œ / Enterã§æ”¹è¡Œã™ã‚‹ã¨è¡Œé ­ã«å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’è‡ªå‹•æŒ¿å…¥</span>
        </label>
        <div class="ta-box">
          <textarea id="content"
            placeholder="éƒ¨ç½²ã®æ´»å‹•å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"></textarea>
          <div class="ta-footer">
            <span id="stat-chars">0æ–‡å­—</span>
            <span id="stat-lines">0è¡Œ</span>
            <span id="stat-over"></span>
          </div>
        </div>
        <div id="line-detail" class="line-detail"></div>
        <div id="content-check"></div>
        <button type="button" class="preview-toggle" id="preview-btn" onclick="togglePreview()">
          â–¶ å‡ºåŠ›ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
        </button>
        <div id="preview-box" class="preview-box"></div>
      </div>
    </div>

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="card">
      <div class="sec-title">ãƒã‚§ãƒƒã‚¯ãƒ»ä¿å­˜</div>
      <div class="btn-row">
        <button type="button" class="btn btn-outline" onclick="runAllChecks()">ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ</button>
        <button type="submit" class="btn btn-primary" id="save-btn">ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜</button>
      </div>

      <!-- ã‚¨ãƒ©ãƒ¼ãƒ»æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒœã‚¿ãƒ³ç›´ä¸‹ï¼‰ -->
      <div id="save-result"></div>

      <label class="contact-check-label" id="contact-check-wrap">
        <input type="checkbox" id="contact-check">
        å•ã„åˆã‚ã›å…ˆï¼ˆé€£çµ¡å…ˆãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ï¼‰ã‚’æœ¬æ–‡ã«è¨˜è¼‰ã—ã¾ã—ãŸã‹ï¼Ÿ
      </label>
      <div class="info-box">
        ğŸ“¥ <strong>ä¿å­˜ã«ã¤ã„ã¦</strong><br>
        ã€Œãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜ã€ã‚’æŠ¼ã™ã¨ã€ãƒ¡ãƒ«ãƒã‚¬å½¢å¼ã«æ•´å½¢ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚<br>
        ãƒ»æ®µè½ã®å…ˆé ­ã«å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’è‡ªå‹•æŒ¿å…¥ã—ã¾ã™<br>
        ãƒ»1è¡Œ20æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã¯è‡ªå‹•æ”¹è¡Œã•ã‚Œã¾ã™<br>
        ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã€Œãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒ•ã‚©ãƒ«ãƒ€ã«è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™ã€‚ä¿å­˜å¾Œã€ç®¡ç†ãƒ•ã‚©ãƒ«ãƒ€ã¸ï¼ˆãƒ¡ãƒ¼ãƒ«ã§ã”æ¡ˆå†…ã—ãŸå ´æ‰€ã«ï¼‰ç§»å‹•ã—ã¦ãã ã•ã„ã€‚<br>
        ãƒ•ã‚¡ã‚¤ãƒ«åã®å½¢å¼ï¼š<code>YYYYMMDD_HHMMSS_éƒ¨ç½²å.txt</code>
      </div>
      <div class="ai-note">
        ğŸ’¡ <strong>èª¤å­—è„±å­—ãƒã‚§ãƒƒã‚¯ã«ã¤ã„ã¦</strong><br>
        å…¨è§’æ•°å­—ãƒ»å…¨è§’è‹±å­—ãƒ»ç¹°ã‚Šè¿”ã—æ–‡å­—ãªã©ã®åŸºæœ¬ãƒã‚§ãƒƒã‚¯ã¯è‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚<br>
        åŒéŸ³ç•°ç¾©èªã‚„æ–‡è„ˆã‚¨ãƒ©ãƒ¼ãªã©ã€ã‚ˆã‚Šé«˜åº¦ãªæ¤œå‡ºã«ã¯AIé€£æºãŒå¿…è¦ã§ã™ï¼ˆç¾ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯å¯¾å¿œå¤–ï¼‰ã€‚
      </div>
    </div>

  </form>
</div>

<script>
'use strict';

const $ = id => document.getElementById(id);

/* ===== å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */

const toHalfNum = str =>
  str.replace(/[ï¼-ï¼™]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFF10 + 0x30));

const toHalfAlpha = str =>
  str.replace(/[ï¼¡-ï¼º]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0))
     .replace(/[ï½-ï½š]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0));

const hasFullWidthNum   = str => /[ï¼-ï¼™]/.test(str);
const hasFullWidthAlpha = str => /[ï¼¡-ï¼ºï½-ï½š]/.test(str);

const esc = s =>
  s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

/* ===== trimï¼šå…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã¯æ®‹ã—ã€åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ãƒ»æ”¹è¡Œã®ã¿é™¤å» =====
   JavaScriptæ¨™æº–ã® .trim() ã¯å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆU+3000ï¼‰ã‚‚é™¤å»ã—ã¦ã—ã¾ã†ãŸã‚ã€
   æ®µè½é ­ã®ã€€ãŒæ¶ˆãˆãªã„ã‚ˆã†å°‚ç”¨é–¢æ•°ã‚’ä½¿ã†ã€‚
================================================ */
function trimContent(str) {
  return str.replace(/^[ \t\n\r]+|[ \t\n\r]+$/g, '');
}

/* ===== URLã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å«ã‚€è¡Œã¯æ”¹è¡Œã—ãªã„ ===== */
function isNoWrapLine(line) {
  if (/https?:\/\//.test(line)) return true;  // URL
  if (/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}/.test(line)) return true; // ãƒ¡ãƒ¼ãƒ«
  return false;
}

/* ===== 20æ–‡å­—æ”¹è¡Œ ===== */
function wrapAt20(text) {
  return text.split('\n').map(line => {
    if (line.length <= 20) return line;
    if (isNoWrapLine(line)) return line; // URLãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹è¡Œã¯ãã®ã¾ã¾
    const chunks = [];
    for (let i = 0; i < line.length; i += 20) chunks.push(line.slice(i, i + 20));
    return chunks.join('\n');
  }).join('\n');
}

/* ===== ãƒ¡ãƒ«ãƒã‚¬å½¢å¼ãƒ†ã‚­ã‚¹ãƒˆã®çµ„ã¿ç«‹ã¦ ===== */
function buildNewsletterText(department, content) {
  // ZWSï¼ˆæ”¹è¡Œä¿è­·ãƒãƒ¼ã‚«ãƒ¼ï¼‰ã‚’é™¤å»ã—ã¦ã‹ã‚‰å‡ºåŠ›
  const cleaned   = content.replace(new RegExp(ZWS, 'g'), '');
  const formatted = wrapAt20(cleaned);
  return `ã€${department}ã€‘\n\n${formatted}\n`;
}

/* ===== éƒ¨ç½²åã®å–å¾— ===== */
function getDepartment() {
  const sel = $('department').value;
  if (sel === 'ãã®ä»–ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰') return $('department_custom').value.trim();
  return sel;
}

/* ===== ç¾åœ¨æ—¥æ™‚æ–‡å­—åˆ— ===== */
function nowString() {
  const d = new Date();
  const pad = n => String(n).padStart(2, '0');
  return `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}`;
}

/* ===== éƒ¨ç½²é¸æŠã®ã€Œãã®ä»–ã€åˆ¶å¾¡ ===== */
$('department').addEventListener('change', function () {
  const isOther = this.value === 'ãã®ä»–ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰';
  $('department_custom').style.display = isOther ? 'block' : 'none';
});

/* ===== ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ 20æ–‡å­—æ•´å½¢ï¼ˆæŠ˜ã‚Šè¿”ã—ï¼‹å¼•ãæˆ»ã—ï¼‰ =====
   ãƒ»20æ–‡å­—ã‚’è¶…ãˆãŸè¡Œã¯æ¬¡ã®è¡Œã¸æŠ˜ã‚Šè¿”ã™
   ãƒ»å‰ã®è¡ŒãŒ20æ–‡å­—æœªæº€ã®ã¨ãã€ç¶šãã®è¡Œã‹ã‚‰æ–‡å­—ã‚’å¼•ãæˆ»ã—ã¦è©°ã‚ã‚‹
   ãƒ»ä»¥ä¸‹ã®è¡Œã¯æ•´å½¢å¯¾è±¡å¤–ï¼ˆãã®ã¾ã¾ä¿æŒï¼‰ï¼š
     - ç©ºè¡Œ
     - ã€€ã§å§‹ã¾ã‚‹è¡Œï¼ˆæ‰‹å‹•Enterã«ã‚ˆã‚‹æ®µè½å…ˆé ­ï¼‰
     - URLãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å«ã‚€è¡Œ
================================================ */
const contentEl = $('content');
let _wrapping = false;

// pos ã® \n ãŒè‡ªå‹•æŠ˜ã‚Šè¿”ã—ã«ã‚ˆã‚‹ã‚‚ã®ã‹ï¼ˆæ‰‹å‹•æ”¹è¡Œï¼æ®µè½åŒºåˆ‡ã‚Šã§ã¯ãªã„ã‹ï¼‰ã‚’åˆ¤å®š
function isAutoWrapNL(text, pos) {
  if (text[pos] !== '\n') return false;
  if (pos + 1 >= text.length) return false;       // æœ«å°¾ã® \n ã¯æ‰‹å‹•æ‰±ã„
  const next = text[pos + 1];
  if (next === '\n' || next === 'ã€€' || next === ZWS) return false; // ç©ºè¡Œ or æ®µè½å…ˆé ­ = æ‰‹å‹•
  const lineEnd = text.indexOf('\n', pos + 1);
  const nextLine = lineEnd === -1 ? text.slice(pos + 1) : text.slice(pos + 1, lineEnd);
  if (isNoWrapLine(nextLine)) return false;         // URL/ãƒ¡ãƒ¼ãƒ«è¡Œã®å‰ = æ‰‹å‹•æ‰±ã„
  return true; // è‡ªå‹•æŠ˜ã‚Šè¿”ã— \n
}

// ã‚«ãƒ¼ã‚½ãƒ«ç‰©ç†ä½ç½® â†’ è«–ç†ä½ç½®ï¼ˆè‡ªå‹•æŠ˜ã‚Šè¿”ã— \n ã‚’é™¤ã„ãŸæ–‡å­—æ•°ï¼‰
function logicalCursor(text, physPos) {
  let n = 0;
  for (let i = 0; i < physPos; i++) {
    if (!isAutoWrapNL(text, i)) n++;
  }
  return n;
}

// è«–ç†ä½ç½® â†’ ã‚«ãƒ¼ã‚½ãƒ«ç‰©ç†ä½ç½®ï¼ˆé€†ç®—ï¼‰
function physCursor(text, logPos) {
  let n = 0;
  for (let i = 0; i <= text.length; i++) {
    if (n === logPos) return i;
    if (i < text.length && !isAutoWrapNL(text, i)) n++;
  }
  return text.length;
}

function enforceWrap() {
  if (_wrapping) return;

  const original  = contentEl.value;
  const cursorPos = contentEl.selectionStart;
  const lines     = original.split('\n');
  const out       = [];
  let i = 0;

  while (i < lines.length) {
    const line = lines[i];

    // ç©ºè¡Œï¼šãã®ã¾ã¾ä¿æŒ
    if (line === '') { out.push(line); i++; continue; }

    // URLãƒ»ãƒ¡ãƒ¼ãƒ«è¡Œï¼šãã®ã¾ã¾ä¿æŒ
    if (isNoWrapLine(line)) { out.push(line); i++; continue; }

    // æ®µè½ã‚’åé›†ï¼šã“ã®è¡Œ ï¼‹ å¾Œç¶šã®ç¶™ç¶šè¡Œ
    // ç¶™ç¶šè¡Œã®æ¡ä»¶ï¼šç©ºè¡Œã§ãªã„ãƒ»ã€€ã§å§‹ã¾ã‚‰ãªã„ãƒ»URL/ãƒ¡ãƒ¼ãƒ«ã§ãªã„
    let para = line;
    let j = i + 1;
    while (j < lines.length) {
      const next = lines[j];
      if (next === '' || next.startsWith('ã€€') || next.startsWith(ZWS) || isNoWrapLine(next)) break;
      para += next;
      j++;
    }

    // æ®µè½ã‚’20æ–‡å­—ã”ã¨ã«æŠ˜ã‚Šè¿”ã—ã¦å‡ºåŠ›
    for (let p = 0; p < para.length; p += 20) {
      out.push(para.slice(p, p + 20));
    }

    i = j;
  }

  const newText = out.join('\n');

  if (newText !== original) {
    const logPos = logicalCursor(original, cursorPos);
    _wrapping = true;
    contentEl.value = newText;
    const nc = physCursor(newText, logPos);
    contentEl.setSelectionRange(nc, nc);
    _wrapping = false;
  }
}

/* ===== ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆ ===== */

function updateStats() {
  const text  = contentEl.value;
  const lines = text.split('\n');

  $('stat-chars').textContent = text.length + 'æ–‡å­—';
  $('stat-lines').textContent = lines.length + 'è¡Œ';
  $('stat-over').textContent  = '';   // å¼·åˆ¶æ”¹è¡ŒONæ™‚ã¯è¶…éè¡Œãªã—

  // è¡Œè©³ç´°ãƒ‘ãƒãƒ«ã¯ä¸è¦ã«ãªã‚‹ã®ã§éè¡¨ç¤º
  $('line-detail').style.display = 'none';

  if ($('preview-box').style.display !== 'none') updatePreview();
  $('preview-btn').style.display = text.trim() ? 'inline' : 'none';
}

/* ===== æ”¹è¡Œä¿è­·ãƒãƒ¼ã‚«ãƒ¼ =====
   ZWSï¼ˆã‚¼ãƒ­å¹…ã‚¹ãƒšãƒ¼ã‚¹ï¼‰ã‚’ä¸å¯è¦–ã®ã€Œæ„å›³çš„æ”¹è¡Œãƒãƒ¼ã‚«ãƒ¼ã€ã¨ã—ã¦ä½¿ã†ã€‚
   è¡¨ç¤ºãƒ»å‡ºåŠ›ã«ã¯å½±éŸ¿ã—ãªã„ã€‚enforceWrap ãŒã“ã‚Œã‚’æ®µè½åŒºåˆ‡ã‚Šã¨ã—ã¦èªè­˜ã™ã‚‹ã€‚
================================================ */
const ZWS = '\u200B';

/* ===== 1è¡Œç›®ï¼šãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’è‡ªå‹•æŒ¿å…¥ ===== */
contentEl.addEventListener('focus', () => {
  if (contentEl.value === '') {
    contentEl.value = 'ã€€';
    contentEl.setSelectionRange(1, 1);
  }
});
// ä½•ã‚‚å…¥åŠ›ã›ãšã«é›¢ã‚ŒãŸã‚‰å…ƒã®ç©ºçŠ¶æ…‹ã«æˆ»ã™ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å¾©æ´»ã•ã›ã‚‹ï¼‰
contentEl.addEventListener('blur', () => {
  if (contentEl.value === 'ã€€') contentEl.value = '';
});

/* ===== Undo / Redo ã‚¹ã‚¿ãƒƒã‚¯ =====
   contentEl.value ã‚’ç›´æ¥æ›¸ãæ›ãˆã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒã‚¤ãƒ†ã‚£ãƒ–UndoãŒ
   ã‚¯ãƒªã‚¢ã•ã‚Œã‚‹ãŸã‚ã€ç‹¬è‡ªã‚¹ã‚¿ãƒƒã‚¯ã§ç®¡ç†ã™ã‚‹ã€‚
================================================ */
const undoStack = [];   // éå»ã®çŠ¶æ…‹
const redoStack = [];   // Redoç”¨

function saveUndo() {
  const state = { v: contentEl.value, c: contentEl.selectionStart };
  const last  = undoStack[undoStack.length - 1];
  if (last && last.v === state.v) return; // å¤‰åŒ–ãªã‘ã‚Œã°ä¿å­˜ã—ãªã„
  undoStack.push(state);
  redoStack.length = 0; // æ–°ã—ã„ç·¨é›†ã§Redoã‚’ã‚¯ãƒªã‚¢
  if (undoStack.length > 300) undoStack.shift(); // æœ€å¤§300ä»¶
}

let _saveTimer = null;
function scheduleSave() {
  clearTimeout(_saveTimer);
  _saveTimer = setTimeout(saveUndo, 600); // 600msç„¡æ“ä½œã§ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä¿å­˜
}

/* ===== IME å¤‰æ›ãƒ•ãƒ©ã‚° ===== */
let _isComposing = false;
contentEl.addEventListener('compositionstart', () => { _isComposing = true; });
contentEl.addEventListener('compositionend', () => {
  _isComposing = false;
  saveUndo(); // å¤‰æ›ç¢ºå®šã‚’ã²ã¨ã¤ã®Undoå˜ä½ã¨ã—ã¦ä¿å­˜
  enforceWrap();
  updateStats();
  liveCheck('content');
});

/* ===== ã‚­ãƒ¼æ“ä½œï¼ˆUndo/Redo / Enter / Backspaceï¼‰ ===== */
contentEl.addEventListener('keydown', e => {

  const isMac  = navigator.platform.toUpperCase().includes('MAC');
  const mod    = isMac ? e.metaKey : e.ctrlKey; // Mac=Cmdã€Win=Ctrl

  /* ---------- Undoï¼šCmd+Z / Ctrl+Z ---------- */
  if (mod && e.key === 'z' && !e.shiftKey) {
    e.preventDefault();
    if (undoStack.length > 0) {
      redoStack.push({ v: contentEl.value, c: contentEl.selectionStart });
      const prev = undoStack.pop();
      contentEl.value = prev.v;
      contentEl.setSelectionRange(prev.c, prev.c);
      updateStats();
    }
    return;
  }

  /* ---------- Redoï¼šCmd+Shift+Z / Ctrl+Y / Ctrl+Shift+Z ---------- */
  if ((mod && e.key === 'y') || (mod && e.shiftKey && e.key === 'z')) {
    e.preventDefault();
    if (redoStack.length > 0) {
      undoStack.push({ v: contentEl.value, c: contentEl.selectionStart });
      const next = redoStack.pop();
      contentEl.value = next.v;
      contentEl.setSelectionRange(next.c, next.c);
      updateStats();
    }
    return;
  }

  if (_isComposing || e.isComposing) return; // IMEå¤‰æ›ä¸­ã¯ä»¥ä¸‹ã‚’ç„¡è¦–

  const text   = contentEl.value;
  const cursor = contentEl.selectionStart;
  const selEnd = contentEl.selectionEnd;

  /* ---------- Enterï¼šæ”¹è¡Œ + å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ ---------- */
  if (e.key === 'Enter') {
    e.preventDefault();
    saveUndo(); // å¤‰æ›´å‰ã®çŠ¶æ…‹ã‚’ä¿å­˜
    contentEl.value = text.slice(0, cursor) + '\nã€€' + text.slice(selEnd);
    contentEl.setSelectionRange(cursor + 2, cursor + 2);
    contentEl.dispatchEvent(new Event('input'));
    return;
  }

  /* ---------- Backspaceï¼šè¡Œé ­ã®ç‰¹æ®Šæ–‡å­—ã«å¯¾ã™ã‚‹å‡¦ç† ---------- */
  if (e.key === 'Backspace' && cursor === selEnd) {
    const prevChar  = cursor > 0 ? text[cursor - 1] : '';
    const isLineTop = cursor <= 1 || text[cursor - 2] === '\n';

    // â‘  è¡Œé ­ã® ã€€ â†’ ZWS ã«ç½®ãæ›ãˆã¦æ”¹è¡Œã‚’ä¿è­·
    if (prevChar === 'ã€€' && isLineTop) {
      e.preventDefault();
      saveUndo();
      contentEl.value = text.slice(0, cursor - 1) + ZWS + text.slice(cursor);
      contentEl.setSelectionRange(cursor, cursor);
      contentEl.dispatchEvent(new Event('input'));
      return;
    }

    // â‘¡ è¡Œé ­ã®ZWS â†’ ZWSã¨ç›´å‰ã® \n ã‚’ã¾ã¨ã‚ã¦å‰Šé™¤ï¼ˆå‰ã®è¡Œã«æˆ»ã‚‹ï¼‰
    if (prevChar === ZWS && isLineTop) {
      e.preventDefault();
      saveUndo();
      const from = cursor >= 2 && text[cursor - 2] === '\n' ? cursor - 2 : cursor - 1;
      contentEl.value = text.slice(0, from) + text.slice(cursor);
      contentEl.setSelectionRange(from, from);
      contentEl.dispatchEvent(new Event('input'));
      return;
    }
  }
});

contentEl.addEventListener('input', () => {
  if (_isComposing) return; // IMEå¤‰æ›ä¸­ã¯ä¸€åˆ‡å‡¦ç†ã—ãªã„
  scheduleSave(); // 600mså¾Œã«ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä¿å­˜
  enforceWrap();
  updateStats();
  liveCheck('content');
});

/* ===== ãƒ©ã‚¤ãƒ–å…¨è§’ãƒã‚§ãƒƒã‚¯ ===== */
function liveCheck(id) {
  const val = $(id).value;
  const out = $(id + '-check');
  if (!out) return;
  const hasN = hasFullWidthNum(val), hasA = hasFullWidthAlpha(val);
  if (!hasN && !hasA) { out.innerHTML = ''; return; }
  let items = '';
  if (hasN) items += item('âš ï¸', 'å…¨è§’æ•°å­—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚æ•°å­—ã¯åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', `fixFW('${id}','num')`);
  if (hasA) items += item('âš ï¸', 'å…¨è§’ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚åŠè§’ã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚', `fixFW('${id}','alpha')`);
  out.innerHTML = `<div class="check-panel issues">${items}</div>`;
}

function item(icon, msg, fixCall) {
  const btn = fixCall ? `<button class="fix-btn" onclick="${fixCall}">è‡ªå‹•ä¿®æ­£</button>` : '';
  return `<div class="check-item"><span class="check-ico">${icon}</span><span>${msg}${btn}</span></div>`;
}

/* ===== è‡ªå‹•ä¿®æ­£ ===== */
function fixFW(id, type) {
  const el = $(id);
  if (type === 'num')   el.value = toHalfNum(el.value);
  if (type === 'alpha') el.value = toHalfAlpha(el.value);
  el.dispatchEvent(new Event('input'));
}

/* ===== å…¨ãƒã‚§ãƒƒã‚¯ ===== */
function runAllChecks() {
  const dept    = getDepartment();
  const content = trimContent(contentEl.value);
  const errors  = [];

  if (!dept)    errors.push('ãƒ»éƒ¨ç½²åãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
  if (!content) errors.push('ãƒ»æœ¬æ–‡ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
  if (!$('contact-check').checked) errors.push('ãƒ»ã€Œå•ã„åˆã‚ã›å…ˆã‚’è¨˜è¼‰ã—ã¾ã—ãŸã‹ï¼Ÿã€ã«ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ã¦ã„ã¾ã›ã‚“ã€‚');

  if (errors.length > 0) {
    $('save-result').innerHTML =
      `<div class="alert alert-error"><strong>âš ï¸ ä»¥ä¸‹ã®é …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„</strong><br>${errors.join('<br>')}</div>`;
    return;
  }

  // å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å†…å®¹ãƒã‚§ãƒƒã‚¯
  checkContent();
  $('save-result').innerHTML = '<div class="alert alert-success">âœ… å…¥åŠ›å†…å®¹ã«å•é¡Œã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>';
}

function checkContent() {
  const text = contentEl.value.trim();
  const out  = $('content-check');
  if (!text) return;

  const issues = [];

  if (hasFullWidthNum(text))
    issues.push({ icon:'âš ï¸', msg:'å…¨è§’æ•°å­—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚', fix:"fixFW('content','num')" });

  if (hasFullWidthAlpha(text))
    issues.push({ icon:'âš ï¸', msg:'å…¨è§’ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚', fix:"fixFW('content','alpha')" });

  const triples = text.match(/(.)\1{2,}/g);
  if (triples) {
    const uniq = [...new Set(triples)];
    issues.push({ icon:'ğŸ”', msg:`åŒã˜æ–‡å­—ãŒ3å›ä»¥ä¸Šé€£ç¶šï¼šã€Œ${uniq.join('ã€ã€Œ')}ã€ â€” æ„å›³çš„ã‹ã”ç¢ºèªãã ã•ã„ã€‚`, fix: null });
  }

  if (/[ \u3000]{2,}/.test(text))
    issues.push({ icon:'ğŸ”', msg:'ã‚¹ãƒšãƒ¼ã‚¹ãŒé€£ç¶šã—ã¦ã„ã¾ã™ã€‚ã”ç¢ºèªãã ã•ã„ã€‚', fix: null });

  const overCount = text.split('\n').filter(l => l.length > 20).length;
  if (overCount > 0)
    issues.push({ icon:'ğŸ“', msg:`${overCount}è¡ŒãŒ20æ–‡å­—ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚ä¿å­˜æ™‚ã«è‡ªå‹•æ”¹è¡Œã•ã‚Œã¾ã™ã€‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚`, fix: null });

  renderChecks(out, issues);
}

function renderChecks(outEl, issues) {
  if (issues.length === 0) {
    outEl.innerHTML = '<div class="check-panel clean">âœ… ãƒã‚§ãƒƒã‚¯å®Œäº†ï¼šå•é¡Œã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>';
    return;
  }
  outEl.innerHTML = `<div class="check-panel issues">${issues.map(i => item(i.icon, i.msg, i.fix)).join('')}</div>`;
}

/* ===== ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ ===== */
let previewOpen = false;
function togglePreview() {
  previewOpen = !previewOpen;
  $('preview-box').style.display = previewOpen ? 'block' : 'none';
  $('preview-btn').textContent = previewOpen ? 'â–¼ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹' : 'â–¶ å‡ºåŠ›ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º';
  if (previewOpen) updatePreview();
}
function updatePreview() {
  const dept    = getDepartment() || 'ï¼ˆéƒ¨ç½²åæœªé¸æŠï¼‰';
  const content = trimContent(contentEl.value);
  $('preview-box').textContent = content
    ? buildNewsletterText(dept, content)
    : 'ï¼ˆæœ¬æ–‡ã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰';
}

// å•ã„åˆã‚ã›å…ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®è¦‹ãŸç›®ã‚’åˆ‡ã‚Šæ›¿ãˆ
$('contact-check').addEventListener('change', function () {
  $('contact-check-wrap').classList.toggle('checked', this.checked);
});

// éƒ¨ç½²å¤‰æ›´ã‚‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«åæ˜ 
['department', 'department_custom'].forEach(id => {
  const el = $(id);
  if (el) el.addEventListener('input', () => {
    if (previewOpen) updatePreview();
  });
});

/* ===== ãƒ†ã‚­ã‚¹ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ ===== */
function downloadText(text, filename) {
  const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href     = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

/* ===== ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ ===== */
$('mainForm').addEventListener('submit', e => {
  e.preventDefault();

  const department = getDepartment();
  const content    = trimContent(contentEl.value);

  if (!department) {
    $('save-result').innerHTML = '<div class="alert alert-error">éƒ¨ç½²åã‚’é¸æŠã¾ãŸã¯å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>';
    return;
  }
  if (!content) {
    $('save-result').innerHTML = '<div class="alert alert-error">æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>';
    return;
  }
  if (!$('contact-check').checked) {
    $('save-result').innerHTML = '<div class="alert alert-error">âš ï¸ å•ã„åˆã‚ã›å…ˆã®è¨˜è¼‰ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚</div>';
    $('contact-check-wrap').scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }

  const text = buildNewsletterText(department, content);
  const safeDept = department.replace(/[\/\\:*?"<>|]/g, '');
  const filename = `${nowString()}_${safeDept}.txt`;

  downloadText(text, filename);

  $('save-result').innerHTML =
    `<div class="alert alert-success">âœ… <strong>${filename}</strong> ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚<br>ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ç®¡ç†ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚</div>`;
});
</script>
</body>
</html>
